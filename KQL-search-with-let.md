## KQL - search operator with let statement 
Firstly, "search" is very useful and effective operator in KQL when you look for some key word or data. <br>
> Searches a text pattern in multiple tables and columns.<br>
[search operator - Azure Data Explorer | Microsoft Learn!](https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/searchoperator?pivots=azuredataexplorer)

If you have ever used advanced hunting in Microsoft 365 Defender and selected "Go hunt" option in a device page, you might be seen KQL - seeking a device with let statement and seach operator. 
However, the question is that I haven't ever seen the search scenario with let. Even if I looked at MS docs, [search operator](https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/searchoperator?pivots=azuredataexplorer), I didn't find anything at all. 
Therefore, at this time, IÂ´m going to focus on the use case : seach operator with let statement. 


#### Ex) "Go hunt from" a device page in Microsoft 365 Defender <br>
This query hunts "DeviceA" with time range by filtering some tables such as DeviceEvent, DeviceInfo and so on.

```
let deviceName = "DeviceA";
let deviceId = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";
let selectedTimestamp = datetime(2022-11-22T10:22:11.2370000Z);
search in (IdentityLogonEvents,IdentityQueryEvents,IdentityDirectoryEvents,DeviceProcessEvents,DeviceNetworkEvents,DeviceFileEvents,DeviceRegistryEvents,DeviceLogonEvents,DeviceImageLoadEvents,DeviceEvents)
Timestamp between ((selectedTimestamp - 1h) .. (selectedTimestamp + 1h))
and
(DeviceName == deviceName
//or DeviceId == deviceId
// Events affecting this target device
//or RemoteDeviceName == deviceName
//or TargetDeviceName == deviceName
//or DestinationDeviceName == deviceName
)
| take 100
``` 
<br>

#### Point 1 -  after you write let statement, please be careful to not forget ";" in the end.
```
let deviceName = "DeviceA";
let deviceId = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";
let selectedTimestamp = datetime(2022-11-22T10:22:11.2370000Z);
```
#### Point 2 - you can flexibly choose the timestamp - without let or with let. 
```
// Timestamp with let statement 
let selectedTimestamp = datetime(2022-11-22T10:22:11.2370000Z);
Timestamp between ((selectedTimestamp - 1h) .. (selectedTimestamp + 1h))

// Timestamp without let statement 
Timestamp between (datetime(2022-11-22) .. datetime(2022-11-23))
```
#### Point 3 - when you want to filter with multiple conditions, you can use "and"
```
Timestamp between ((selectedTimestamp - 1h) .. (selectedTimestamp + 1h))
and
(DeviceName == deviceName)
```

## some scenarios 
```
XXXXXXXXXXXXXXX
XXXXXXXXXXXXXXX
XXXXXXXXXXXXXXX
```
